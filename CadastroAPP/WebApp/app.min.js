app.directive("validarData",["$parse",function(o){return{require:"ngModel",link:function(o,e,a,n){e.bind("keyup",function(){var o=e[0].value,a=/^((((0?[1-9]|[12]\d|3[01])[\.\-\/](0?[13578]|1[02])      [\.\-\/]((1[6-9]|[2-9]\d)?\d{2}))|((0?[1-9]|[12]\d|30)[\.\-\/](0?[13456789]|1[012])[\.\-\/]((1[6-9]|[2-9]\d)?\d{2}))|((0?[1-9]|1\d|2[0-8])[\.\-\/]0?2[\.\-\/]((1[6-9]|[2-9]\d)?\d{2}))|(29[\.\-\/]0?2[\.\-\/]((1[6-9]|[2-9]\d)?(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00)|00)))|(((0[1-9]|[12]\d|3[01])(0[13578]|1[02])((1[6-9]|[2-9]\d)?\d{2}))|((0[1-9]|[12]\d|30)(0[13456789]|1[012])((1[6-9]|[2-9]\d)?\d{2}))|((0[1-9]|1\d|2[0-8])02((1[6-9]|[2-9]\d)?\d{2}))|(2902((1[6-9]|[2-9]\d)?(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00)|00))))$/;return a.test(o)?(e.removeClass("error"),n.$setValidity("dateValid",!0),o):(e.addClass("error"),n.$setValidity("dateValid",!1),!1)})}}}]);var fileUpload=function(){return{scope:{files:"="},link:function(o,e,a){function n(){var o=t.parent(),e=t.prop("accept");t.remove();var a=document.createElement("input"),n=document.createAttribute("type");n.nodeValue="file",a.setAttributeNode(n);var n=document.createAttribute("accept");n.nodeValue=e,a.setAttributeNode(n),n=document.createAttribute("multiple"),n.nodeValue="multiple",a.setAttributeNode(n),t=angular.element(a),o.append(t)}var t=e.find("input");e.bind("change",function(e){o.files=e.target.files,o.$apply(),n()}),e.bind("click",function(o){o.stopPropagation()})}}};app.directive("fileUpload",fileUpload);var administracaoService=function(o,e,a,n){var t=a.getUrlBase,r=a.getFuncionarioKey,i={},u=(n.get("autKey"),function(e){return o.get(t+"Usuario/Listar?NomeUsuario="+e.NomeUsuario+"&Pagina="+e.Pagina+"&TotalResultadosPorPagina="+e.TotalResultadosPorPagina,{headers:{Authorization:r}})}),c=function(a){var n=t+"Usuario/Incluir/",i=e.defer(),u={IdLogin:a.IdLogin,Login:a.Login,Senha:a.Senha,SenhaRedigitada:a.SenhaRedigitada,DataCriacao:a.DataCriacao};return o.post(n,u,{headers:{"Content-Type":"application/json",Authorization:r}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise},l=function(a){var n=t+"Usuario/Excluir/Id",i=e.defer();$.param({Id:a});return o["delete"](n,{params:{Id:a},headers:{"Content-Type":"application/json",Authorization:r}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise},s=function(a){var n=t+"Inserir/Empresa/",i=e.defer(),u={Descricao:a.Descricao};return o.post(n,u,{headers:{"Content-Type":"application/json",Authorization:r}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise};return i.obterUsuario=u,i.salvarUsuario=c,i.excluirUsuario=l,i.salvaEmpresa=s,i};administracaoService.$inject=["$http","$q","configuracaoService","storageService"],app.factory("administracaoService",administracaoService);var autService=function(o,e,a,n,t){var r={},i=function(){var o={autenticado:!1,nome:""},a=e.get("autKey");return a&&(o.autenticado=a.autenticado,o.nome=a.usuario),o},u=n.getUrlBase,c=n.getFuncionarioKey,l=function(n){var r=u+"Usuario/Validar/",l=o.defer(),d={login:n.usuario,senha:n.senha};return a.post(r,d,{headers:{"Content-Type":"application/json",Authorization:c}}).then(function(o){o.data.valido===!0?e.set("autKey",{autenticado:!0,usuario:n.usuario,mlcid:t.crypt(n.usuario),mlpa:t.crypt(n.senha)}):s(),l.resolve(i())},function(o){s(),l.reject(o)}),l.promise},s=function(){e.excluir("autKey")};return r.entrar=l,r.sair=s,r.dadosAutenticacao=i,r};autService.$inject=["$q","storageService","$http","configuracaoService","utilsService"],app.factory("autService",autService);var configuracaoService=function(){var o={};return o.getUrlBase="//localhost:47073/api/Funcionario/",o.getFuncionarioKey="184ec59ebd6046dayfb69a11d6793987",o.getFilePath="C:/Processamento/Upload/Arquivos",o};configuracaoService.$inject=[],app.factory("configuracaoService",configuracaoService);var funcionarioService=function(o,e,a,n){var t=a.getUrlBase,r=a.getFuncionarioKey,i={},u=(n.get("autKey"),function(e){return o.get(t+"Filtro/Listar?CodigoFuncionario="+e.CodigoFuncionario+"&CodEmpresa="+e.CodEmpresa+"&DataInicio="+e.DataInicio+"&DataFim="+e.DataFim+"&Pagina="+e.Pagina+"&TotalResultadosPorPagina="+e.TotalResultadosPorPagina,{headers:{Authorization:r}})}),c=function(a){var n=t+"Alterar/Id/",i=e.defer(),u={Id:a.IdFuncionario,DataInicio:a.DataInicio,DataFim:a.DataFim,MaxUtilizacao:a.MaxUtilizacao};return o.put(n,u,{headers:{"Content-Type":"application/json",Authorization:r}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise},l=function(a){var n=t+"Excluir/Id",i=e.defer();$.param({Id:a});return o["delete"](n,{params:{Id:a},headers:{"Content-Type":"application/json",Authorization:r}}).then(function(o){i.resolve(o.data)},function(o){i.reject(o)}),i.promise};return i.obterFuncionario=u,i.editarFuncionario=c,i.excluirFuncionario=l,i};funcionarioService.$inject=["$http","$q","configuracaoService","storageService"],app.factory("funcionarioService",funcionarioService);var importacaoService=function(o,e,a,n){var t=a.getUrlBase,r=a.getFuncionarioKey,i=a.getFilePath,u={},c=n.get("autKey"),l=function(e){return o.get(t+"Importacao/Listar/?NomeUsuario="+e.Usuario+"&NomeArquivo="+e.NomeArquivo+"&DataInicio="+e.DataInicio+"&DataFim="+e.DataFim+"&Pagina="+e.Pagina+"&TotalResultadosPorPagina="+e.TotalResultadosPorPagina,{headers:{Authorization:r}})},s=function(a){var n=t+"Inserir/Importacao/",u=e.defer(),l={filePath:i,arquivo:a,nomeArquivo:a.name,nomeUsuario:c.usuario};return d(a).then(function(e){o.post(n,l,{headers:{"Content-Type":"application/json",Authorization:r}}).then(function(o){u.resolve(o.data)},function(o){u.reject(o)})},function(o){u.reject(o)}),u.promise},d=function(a){var n=t+"Upload",i=new FormData;i.append("arquivo_upload",a);var u={method:"POST",url:n,transformRequest:angular.identity,data:i,headers:{"Content-Type":void 0,Authorization:r}},c=e.defer();return o(u).then(function(o){c.resolve(o)},function(o){c.reject("Houve um erro. Tente novamente.")}),c.promise};return u.obterLogImportacao=l,u.importarFuncionario=s,u};importacaoService.$inject=["$http","$q","configuracaoService","storageService"],app.factory("importacaoService",importacaoService);var storageService=function($localStorage,$sessionStorage){var storageServiceFactory={},tipo="local",_configurar=function(o){tipo=o},_get=function(k){return"session"===tipo?eval("$sessionStorage."+k):"local"===tipo?eval("$localStorage."+k):void 0},_set=function(o,e){"session"===tipo?$sessionStorage[o]=e:"local"===tipo&&($localStorage[o]=e)},_excluir=function(k,v){"session"===tipo?eval("delete $sessionStorage."+k+";"):"local"===tipo&&eval("delete $localStorage."+k+";")};return storageServiceFactory.configurar=_configurar,storageServiceFactory.get=_get,storageServiceFactory.set=_set,storageServiceFactory.excluir=_excluir,storageServiceFactory};storageService.$inject=["$localStorage","$sessionStorage"],app.factory("storageService",storageService);var utilsService=function(){var o={},e=function(o,e,a){for(var n=0;n<o.length;n++)if(o[n][e]===a)return o[n];return null},a=function(o){return void 0==o||""===o?0:parseFloat(o).toFixed(2).replace(".",",")},n=function(o){return o.split("").reverse().join("")},t=function(o){return o.split("").reverse().join("")};return o.crypt=n,o.decrypt=t,o.formatarValor=a,o.findElementFromArray=e,o};utilsService.$inject=[],app.factory("utilsService",utilsService);var headerController=function(o,e){var a=this,n={};a.pedidoAberto=!1,a.aba=o.current.name;var t=function(){var o=e.dadosAutenticacao();n.nome=o.nome,n.autenticado=o.autenticado},r=function(){e.sair(),o.go("login")},i=function(){o.go("administracao")},u=function(){o.go("importacao")},c=function(){o.go("funcionario")};a.init=t,a.administracao=i,a.importacao=u,a.funcionario=c,a.dados=n,a.sair=r};headerController.$inject=["$state","autService"],app.controller("headerController",headerController);var loginController=function(o,e,a){var n=this,t=function(){n.dados={},n.erro={},n.dados.usuario="",n.dados.senha="",n.erro.mensagem=null,a.sair()},r=function(){a.entrar(n.dados).then(function(o){o.autenticado?(n.erro.mensagem=null,e.go("importacao")):(n.erro.mensagem="Dados inválidos",document.querySelector("#loginUser").focus())},function(o){n.erro.mensagem=o,document.querySelector("#loginUser").focus()})};n.init=t,n.entrar=r};loginController.$inject=["$scope","$state","autService"],app.controller("loginController",loginController);var empresaModalController=function(o,e,a,n,t){var r=this;r.erro={},r.sucesso={},r.erro.mensagem=null,r.sucesso.mensagem=null,r.empresa=null,r.init=function(){r.empresa=t},r.salvaEmpresa=function(){null!==r.empresa?window.confirm("Deseja incluir empresa?")&&n.salvaEmpresa(r.empresa).then(function(o){o.valido?r.sucesso.mensagem=o.mensagem:(us.sucesso=null,us.erro.mensagem=o.mensagem)},function(o){r.sucesso=null,r.erro.mensagem="Dados inválidos"}):(r.sucesso=null,r.erro.mensagem="Dados inválidos")},r.close=function(){a.close(r.empresa)},r.cancel=function(){a.dismiss("cancel")}};empresaModalController.$inject=["$scope","$state","$uibModalInstance","administracaoService","registro"],app.controller("empresaModalController",empresaModalController);var funcionarioModalController=function(o,e,a,n,t){var r=this;r.erro={},r.sucesso={},r.erro.mensagem=null,r.sucesso.mensagem=null,r.funcionario=null,r.init=function(){r.funcionario=t},r.alteraFuncionario=function(){null!==r.funcionario?window.confirm("Deseja alterar o funcionario?")&&n.editarFuncionario(r.funcionario).then(function(o){o.valido?r.sucesso.mensagem=o.mensagem:(us.sucesso=null,us.erro.mensagem=o.mensagem)},function(o){r.sucesso=null,r.erro.mensagem="Dados inválidos"}):(r.sucesso=null,r.erro.mensagem="Dados inválidos")},r.close=function(){a.close(r.funcionario)},r.cancel=function(){a.dismiss("cancel")}};funcionarioModalController.$inject=["$scope","$state","$uibModalInstance","funcionarioService","registro"],app.controller("funcionarioModalController",funcionarioModalController);var importacaoModalController=function(o,e,a,n){var t=this,r=angular.element,i=angular,u=/text.*/,c="{0} não é um arquivo de texto válido ";t.erro={},t.sucesso={},t.erro.mensagem=null,t.sucesso.mensagem=null,t.arquivo=null,t.init=function(){t.arquivo=null},t.importarFuncionario=function(){null!==t.arquivo?n.importarFuncionario(t.arquivo).then(function(o){t.erro.mensagem=null,t.sucesso.mensagem="Arquivo importado com sucesso.",t.arquivo=null},function(o){t.sucesso=null,t.erro.mensagem="Dados inválidos"}):(t.sucesso=null,t.erro.mensagem="Dados inválidos")},t.close=function(){a.close("close")},t.cancel=function(){a.dismiss("cancel")},t.showUploadDialog=function(o,e){r(o.currentTarget).parent().parent().find("input:file").trigger("click"),o.stopPropagation()},t.preValidateFiles=function(o){for(var e=u,a={valid:[],invalid:[],errorMessage:null},n=0;n<o.length;n++){var t=!1,r=o[n];r.type.match(e)||(a.invalid.push({file:r.name,message:c.replace("{0}",r.name)}),t=!0),t||a.valid.push({file:r.name,fileData:r})}return a},t.onSelectUploadFiles=function(o){if(o=null==o?o=[]:o,console.log(o),t.uploadErrors=[],o&&1==o.length){t.arquivo=o[0];var e=t.preValidateFiles(o);e.errorMessage&&t.uploadErrors.push(e.errorMessage),e.invalid.length&&(i.forEach(e.invalid,function(o){t.uploadErrors.push(o.message)}),t.arquivo=null)}},o.$watch("filesUploadAttempt",function(o){t.onSelectUploadFiles(o)})};importacaoModalController.$inject=["$scope","$state","$uibModalInstance","importacaoService"],app.controller("importacaoModalController",importacaoModalController);var usuarioModalController=function(o,e,a,n,t){var r=this;r.hasError=!1,r.messageError="",r.usuario={IdLogin:null,Login:null,Senha:null,SenhaRedigitada:null},r.init=function(){t&&(r.usuario.IdLogin=t.IdLogin,r.usuario.Login=t.Login),r.erro={},r.sucesso={},r.erro.mensagem=null,r.sucesso.mensagem=null},r.salvarUsuario=function(){null!==r.usuario?window.confirm("Deseja salvar o Usuário?")&&n.salvarUsuario(r.usuario).then(function(o){o.valido?r.sucesso.mensagem=o.mensagem:(r.sucesso=null,r.erro.mensagem=o.mensagem)},function(o){r.sucesso=null,r.erro.mensagem=resultado.mensagem}):(r.sucesso=null,r.erro.mensagem="Dados inválidos")},r.close=function(){a.close(r.funcionario)},r.cancel=function(){a.dismiss("cancel")}};usuarioModalController.$inject=["$scope","$state","$uibModalInstance","administracaoService","registro"],app.controller("usuarioModalController",usuarioModalController);var importacaoController=function(o,e,a,n,t){var r=this;r.init=function(){var o=a.dadosAutenticacao();null!=o&&o.autenticado?(r.responseImportacao={},r.PaginaAtual=1,r.TotalPaginas=1,r.TotalDeRegistros=1,r.maxSize=5,r.importacaoRequest={Usuario:null,NomeArquivo:null,DataInicio:null,DataFim:null,Pagina:1,TotalResultadosPorPagina:10},i()):e.go("login")},r.filtrar=function(){r.importacaoRequest.Pagina=1,i()};var i=function(){t.obterLogImportacao(r.importacaoRequest).then(function(o){r.responseImportacao=o.data,r.PaginaAtual=r.importacaoRequest.Pagina,r.TotalPaginas=o.data.TotalPaginas,r.TotalDeRegistros=o.data.TotalDeRegistros},function(o){})};o.setPage=function(o){r.PaginaAtual=o},o.pageChanged=function(){r.importacaoRequest.Pagina=r.PaginaAtual,i()},r.openModalimportar=function(o){var e=n.open({templateUrl:"modals/importacaoModal.html",controller:importacaoModalController,controllerAs:"modalimp",size:o,resolve:{}});e.result.then(function(o){r.filtrar()},function(){console.log("Modal dismissed at: "+new Date)})}};importacaoController.$inject=["$scope","$state","autService","$uibModal","importacaoService"],app.controller("importacaoController",importacaoController);var funcionarioController=function(o,e,a,n,t){var r=this;r.init=function(){var o=n.dadosAutenticacao();null!=o&&o.autenticado?(r.responseFuncionario={},r.PaginaAtual=1,r.TotalPaginas=1,r.TotalDeRegistros=1,r.maxSize=5,r.funcionarioRequest={CodigoFuncionario:null,CodEmpresa:null,DataInicio:null,DataFim:null,Pagina:1,TotalResultadosPorPagina:10},i()):e.go("login")},r.filtrar=function(){r.funcionarioRequest.Pagina=1,i()};var i=function(){t.obterFuncionario(r.funcionarioRequest).then(function(o){r.responseFuncionario=o.data,r.PaginaAtual=r.funcionarioRequest.Pagina,r.TotalPaginas=o.data.TotalPaginas,r.TotalDeRegistros=o.data.TotalDeRegistros},function(o){})};r.excluirFuncionario=function(o){window.confirm("Deseja Exluir o funcionario "+o+"?")&&t.excluirFuncionario(o).then(function(o){i()},function(o){})},o.setPage=function(o){r.PaginaAtual=o},o.pageChanged=function(){r.funcionarioRequest.Pagina=r.PaginaAtual,i()},r.openModalEditar=function(o,e){var n=a.open({templateUrl:"modals/funcionarioModal.html",controller:funcionarioModalController,controllerAs:"modalfuncionario",size:o,resolve:{registro:function(){return e}}});n.result.then(function(o){r.filtrar()},function(){console.log("Modal dismissed at: "+new Date)})}};funcionarioController.$inject=["$scope","$state","$uibModal","autService","funcionarioService"],app.controller("funcionarioController",funcionarioController);var administracaoController=function(o,e,a,n,t){var r=this;r.init=function(){var o=n.dadosAutenticacao();null!=o&&o.autenticado?(r.responseUsuario={},r.PaginaAtual=1,r.TotalPaginas=1,r.TotalDeRegistros=1,r.maxSize=5,r.usuarioRequest={NomeUsuario:null,Pagina:1,TotalResultadosPorPagina:10},i()):e.go("login")},r.filtrar=function(){r.usuarioRequest.Pagina=1,i()};var i=function(){t.obterUsuario(r.usuarioRequest).then(function(o){r.responseUsuario=o.data,r.PaginaAtual=r.usuarioRequest.Pagina,r.TotalPaginas=o.data.TotalPaginas,r.TotalDeRegistros=o.data.TotalDeRegistros},function(o){})};r.excluirUsuario=function(o,e){window.confirm("Deseja Exluir o Usuário "+e+"?")&&t.excluirUsuario(o).then(function(o){i()},function(o){})},o.setPage=function(o){cp.PaginaAtual=o},o.pageChanged=function(){cp.funcionarioRequest.Pagina=cp.PaginaAtual,i()},r.openModalUsuario=function(o){var e=a.open({templateUrl:"modals/usuarioModal.html",controller:"usuarioModalController",controllerAs:"modalusuario",size:"lg",resolve:{registro:function(){return o}}});e.result.then(function(o){r.filtrar()},function(){console.log("Modal dismissed at: "+new Date)})}};administracaoController.$inject=["$scope","$state","$uibModal","autService","administracaoService"],app.controller("administracaoController",administracaoController);
